"use strict";(function(a,b){if(typeof define==="function"&&define.amd){define(b)}else{if(typeof exports==="object"){module.exports=b(a)}else{a.returnExports=b(a)}}}(this,function(){function a(b){if(!window.localStorage){this.__log("Your agent does not support localStorage!");return{init:function(){this.__log("Init failed!")},save:function(){this.__log("Init failed!")},del:function(){this.__log("Init failed!")},get:function(){this.__log("Init failed!")},update:function(){this.__log("Init failed!")},flush:function(){this.__log("Init failed!")},getSize:function(){this.__log("Init failed!")}}}this.DATATYPE="JSON";this.EXPIRE=1;this.ISCLEANDIRTYSTORAGE=false;this.ISCLEANDATAWHENFULL=true;this.TURNONLOGGER=false;this.init(b)}a.prototype.init=function(b){var c=this;b=typeof b!=="object"?{}:b;c.DATATYPE=b.dataType?b.dataType:"JSON";c.EXPIRE=b.expire?b.expire:1;c.ISCLEANDIRTYSTORAGE=b.isCleanDirtyStorage!==false&&b.isCleanDirtyStorage!==undefined?b.isCleanDirtyStorage:"false";if(!isNaN(c.ISCLEANDIRTYSTORAGE)){c._flushDirtyRead(c.ISCLEANDIRTYSTORAGE)}c.ISCLEANDATAWHENFULL=b.isCleanDataWhenFull===false?b.isCleanDataWhenFull:true;c.TURNONLOGGER=b.turnOnLogger?b.turnOnLogger:false};a.prototype.save=function(d,c){var b=this;if(!b.__typeof(d)){return}if(!b.__checkKeyName(d.keyName)){return}b.__add(d,c)};a.prototype.del=function(f,e){var d=this;if(!d.__typeof(f)){return}if(!d.__checkKeyName(f.keyName)){return}var c=f.keyName;localStorage.removeItem(c);var b={data:f,result:1,msg:"Delete "+f.keyName+" successfully!"};e&&typeof e==="function"&&e(b);return b};a.prototype.get=function(d,k){var g=this;if(!g.__typeof(d)){return}if(!g.__checkKeyName(d.keyName)){return}var i=d.keyName;var l=localStorage.getItem(i);var j="";var h="";var c="";var f=null;var b=null;if(l){if(g.DATATYPE==="JSON"){try{l=JSON.parse(localStorage.getItem(i));if(l.value){try{j=JSON.parse(l.value)}catch(e){j=l.value}}else{j=""}h=l.expireDate?l.expireDate:"";c=l.period?l.period:"";f={value:j,expireDate:h,period:c}}catch(e){f=l}b={data:f,result:1,msg:"Find "+i+" as JSON successfully!"}}else{if(g.DATATYPE==="String"){b={data:l,result:2,msg:"Find "+i+" as String successfully!"}}}}else{b={data:l,result:0,msg:"Can not found "+i}}k&&typeof k==="function"&&k(b);return b};a.prototype.update=function(d,c){var b=this;if(!b.__typeof(d)){return}if(!b.__checkKeyName(d.keyName)){return}b.__add(d,c)};a.prototype.flush=function(f){var e=this;for(var b in localStorage){var d=null;try{d=JSON.parse(localStorage[b])}catch(c){e.__log(b+": "+c)}if(d&&d.expireDate){e.del({keyName:b})}}f&&typeof f==="function"&&f()};a.prototype.getSize=function(e,d){var c=0;if(e&&e.keyName&&typeof e==="object"){c=JSON.stringify(localStorage.getItem(e.keyName)).length}else{for(var b in localStorage){c+=JSON.stringify(localStorage[b]).length}}d&&typeof d==="function"&&d(c);return c};a.prototype.getRemainSize=function(e){var d=this;var b=d.getSize();var c=d.__checkUserAgent();var f=c-b;e&&typeof e==="function"&&e(f);return f};a.prototype._flushDirtyRead=function(c,j){var g=this;var l=0;var f=isNaN(c)?0:c;for(var e in localStorage){var k=null;try{k=JSON.parse(localStorage[e])}catch(d){g.__log(e+": "+d)}if(k&&k.expireDate){var b=new Date().getTime();var h=k.expireDate;if(!g.__checkDateTimeFormat(h)){return}if(b-new Date(h).getTime()>f){g.getSize({keyName:e},function(i){l+=i});g.del({keyName:e},function(){g.__log(e+" is passed expire("+h+") and has been deleted!")})}}else{g.__log(e+": this item has no expireDate attribute!")}}j&&typeof j==="function"&&j(l)};a.prototype.__add=function(e,l){var h=this;var j=e.keyName;var k=e.value;var c=e.period&&!isNaN(e.period)?e.period:0;var i=e.expireDate;var d=new Date().getTime();switch(h.EXPIRE){case 1:c=e.period&&!isNaN(e.period)?e.period:1*24*60*60*1000;i=h.__formatDateTime(new Date(d+c));break;case 2:if(h.__checkDateTimeFormat(i)){i=e.expireDate;if(d>new Date(i).getTime()){h.__log("expireDate was less than currentDate. Nothing to be done!");return}}else{return}break;default:c=e.period&&!isNaN(e.period)?e.period:1*24*60*60*1000;d=new Date().getTime();i=h.__formatDateTime(new Date(d+c));break}var m={value:JSON.stringify(e.value),period:c,expireDate:i};try{localStorage.setItem(j,JSON.stringify(m))}catch(f){if(h.ISCLEANDATAWHENFULL===true){h._flushDirtyRead(0,function(n){if(n>JSON.stringify(m).length){try{localStorage.setItem(j,JSON.stringify(m))}catch(o){h.__log(o+", cacheStore has flushed the dirty data in localStorage, but it is not big enough for your item!")}}else{h.__log(o+", cacheStore has flushed the dirty data in localStorage, but it is not big enough for your item!")}})}else{h.__log(f+", localStorage is full!")}}var g={value:e.value,period:c,expireDate:i};var b={data:g,result:1,msg:"Set item "+j+" successfully!"};l&&typeof l==="function"&&l(b);return b};a.prototype.__typeof=function(c){var b=this;if(!(c&&typeof c==="object")){b.__log("The type of PARAM is not correct! Nothing to be done!");return false}else{return true}};a.prototype.__formatDateTime=function(h){var d=function(j){return j<10?"0"+j:j};var g=h.getFullYear();var i=d(h.getMonth()+1);var c=d(h.getDate());var b=d(h.getHours());var f=d(h.getMinutes());var e=d(h.getSeconds());return[[g,i,c].join("/"),[b,f,e].join(":")].join(" ")};a.prototype.__checkDateTimeFormat=function(c){var b=this;var d=/^(?:19|20)[0-9][0-9]\/(?:(?:0[1-9])|(?:1[0-2]))\/(?:(?:[0-2][1-9])|(?:[1-3][0-1])) (?:(?:[0-2][0-3])|(?:[0-1][0-9])):[0-5][0-9]:[0-5][0-9]$/;if(!d.test(c)){b.__log("DateTime`s format is not correct!");return false}return true};a.prototype.__checkKeyName=function(b){var c=this;if(b===undefined||""){c.__log("KEYNAME is undefined. Nothing to be done!");return false}else{return true}};a.prototype.__checkUserAgent=function(){var e=navigator.userAgent;var d=e.indexOf("Opera")>-1;var f=e.indexOf("Firefox")>-1;var h=e.indexOf("Chrome")>-1;var c=e.indexOf("Safari")>-1;var g=e.indexOf("compatible")>-1;var b=e.indexOf("MSIE")>-1;if(d){return 5000000}if(f){return 5000000}if(h){return 5000000}if(c){return 2600000}if(g&&b&&!d){return 4700000}};a.prototype.__log=function(g,f,k,j,i){var h=this;if(h.TURNONLOGGER){if(typeof console!=="undefined"&&console.log){try{console.log.apply(console,Array.prototype.slice.call(arguments))}catch(i){switch(arguments.length){case 0:console.log();break;case 1:console.log(g);break;case 2:console.log(g,f);break;case 3:console.log(g,f,k);break;case 4:console.log(g,f,k,j);break;case 5:console.log(g,f,k,j,i);break}}}}};return a}));